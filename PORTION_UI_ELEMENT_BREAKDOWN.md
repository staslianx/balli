# PORTION SYSTEM UI ELEMENT BREAKDOWN
**Visual map of EVERY UI element and its behavior**

---

## ğŸ“± THE NUTRITION MODAL LAYOUT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† [Recipe Name]                                      [Kapat]    â”‚ â† Navigation Bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Porsiyon] [100g]  â† Segmented Picker                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ PORTION CARD (Only shown when "Porsiyon" tab selected)  â”ƒ â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”« â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ Porsiyon          200g  [- 1.0x +]  â–¼                   â”ƒ â”‚ â† COLLAPSED STATE
â”‚  â”ƒ     â–²              â–²        â–²                            â”ƒ â”‚
â”‚  â”ƒ     â”‚              â”‚        â””â”€ Stepper (- 1.0x +)       â”ƒ â”‚
â”‚  â”ƒ     â”‚              â””â”€ Current portion value             â”ƒ â”‚
â”‚  â”ƒ     â””â”€ Label                                            â”ƒ â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ PORTION CARD - EXPANDED                                  â”ƒ â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”« â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ Porsiyon                                            â–²   â”ƒ â”‚
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”ƒ â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ                      150g                                â”ƒ â”‚ â† Gram Display
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”ƒ â”‚ â† Slider
â”‚  â”ƒ 50g                                          400g        â”ƒ â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ         [  Porsiyonu Kaydet  ]                          â”ƒ â”‚ â† Save Button
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ MAIN NUTRITION CARD                                      â”ƒ â”‚
â”‚  â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”« â”‚
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”ƒ 1 porsiyon: 272g                                        â”ƒ â”‚ â† Header Text (infoText)
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Kalori                                    500 kcal      â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Karbonhidrat                                50 g        â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Lif                                         10 g        â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Åeker                                        5 g        â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Protein                                     30 g        â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ YaÄŸ                                         15 g        â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”ƒ â”‚
â”‚  â”ƒ Glisemik YÃ¼k                                20          â”ƒ â”‚ â† Nutrition Row
â”‚  â”ƒ                                                          â”ƒ â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ Emilim ZamanlamasÄ±                              â–¼       â”ƒ â”‚ â† Chart Section
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ BUG #1: STEPPER DOESN'T UPDATE NUTRITION VALUES

### UI Element: Portion Stepper (- 1.0x +)

**Location:** Inside collapsed portion card header
**File:** `NutritionalValuesView.swift` lines 449-475

```swift
HStack(spacing: 8) {
    Button { portionMultiplier -= 0.5 } label: {
        Image(systemName: "minus.circle.fill")
    }

    Text(String(format: "%.1f", portionMultiplier) + "x")  // â† Shows "1.0x", "1.5x", etc.

    Button { portionMultiplier += 0.5 } label: {
        Image(systemName: "plus.circle.fill")
    }
}
```

### Current Behavior (BROKEN)

```
USER ACTION:     Tap [+] button
                 â†“
BINDING UPDATE:  portionMultiplier: 1.0 â†’ 1.5 âœ…
                 â†“
UI UPDATES:      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Stepper shows "1.5x" âœ…                 â”‚
                 â”‚ Header shows "1 porsiyon: 408g" âœ…      â”‚
                 â”‚ (272g Ã— 1.5 = 408g)                     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Calories: 500 kcal âŒ STAYS THE SAME   â”‚
                 â”‚ Carbs: 50g âŒ STAYS THE SAME            â”‚
                 â”‚ Protein: 30g âŒ STAYS THE SAME          â”‚
                 â”‚ All nutrition rows frozen!              â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**EXPECTED:** Calories should show 750 kcal (500 Ã— 1.5)

### Why It's Broken

**Problem File:** Lines 349-410 (Computed properties)

```swift
// âŒ BROKEN - Computed property not tracked by SwiftUI
private var displayedCalories: String {
    if selectedTab == 0 {
        let value = (Double(caloriesPerServing) ?? 0) * portionMultiplier
        return String(format: "%.0f", value)
    } else {
        return calories
    }
}

// Used in view:
nutritionRow(label: "Kalori", value: displayedCalories, unit: "kcal")
//                                    ^^^^^^^^^^^^^^^^
//                            SwiftUI doesn't track this dependency!
```

**Root Cause:** SwiftUI doesn't know `displayedCalories` depends on `portionMultiplier` because it's called through a computed property.

### Expected Behavior (AFTER FIX)

```
USER ACTION:     Tap [+] button
                 â†“
BINDING UPDATE:  portionMultiplier: 1.0 â†’ 1.5 âœ…
                 â†“
UI UPDATES:      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Stepper shows "1.5x" âœ…                 â”‚
                 â”‚ Header shows "1 porsiyon: 408g" âœ…      â”‚
                 â”‚ Calories: 750 kcal âœ… UPDATES!          â”‚
                 â”‚ Carbs: 75g âœ… UPDATES!                  â”‚
                 â”‚ Protein: 45g âœ… UPDATES!                â”‚
                 â”‚ All nutrition rows scale by 1.5x âœ…     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ BUG #2: SAVED PORTION SHOWS OLD VALUE

### UI Element: Collapsed Portion Card Display

**Location:** Portion card header when collapsed
**File:** `NutritionalValuesView.swift` lines 437-447

```swift
if !isPortionAdjustmentExpanded {
    // Show current portion value
    HStack(alignment: .firstTextBaseline, spacing: 4) {
        Text("\(Int(currentPortionSize))")  // â† Shows "200"
            .font(.system(size: 20, weight: .bold))
            .foregroundStyle(AppTheme.primaryPurple)

        Text("g")
            .font(.system(size: 14, weight: .medium))
            .foregroundStyle(.secondary)
    }
}
```

### Current Behavior (BROKEN)

```
INITIAL STATE:   Portion card shows "200g"
                 â†“
USER ACTION:     1. Tap portion card to expand
                 2. Move slider to 150g
                 3. Tap "Porsiyonu Kaydet"
                 â†“
SAVE LOGIC:      recipe.portionSize = 150g âœ…
                 try viewContext.save() âœ…
                 â†“
UI UPDATES:      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Success banner shows âœ…                 â”‚
                 â”‚ Card collapses âœ…                       â”‚
                 â”‚ Portion card STILL shows "200g" âŒ      â”‚
                 â”‚ (Should show "150g")                    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**EXPECTED:** After save, collapsed card should immediately show "150g"

### Why It's Broken

**Problem:** Recipe is not observable

```swift
struct NutritionalValuesView: View {
    let recipe: Recipe?  // âŒ NOT OBSERVABLE
    //  ^^^
    //  When recipe.portionSize changes, SwiftUI doesn't re-render!

    private var currentPortionSize: Double {
        guard let recipe = recipe else { return 0 }
        return recipe.portionSize > 0 ? recipe.portionSize : recipe.totalRecipeWeight
        //     ^^^^^^^^^^^^^^^^^^^^
        //     Reads from recipe but SwiftUI doesn't know to update when it changes!
    }
}
```

**Data Flow:**
1. âœ… User saves â†’ `recipe.portionSize` updates in Core Data
2. âœ… Core Data persists successfully
3. âŒ SwiftUI view doesn't re-read `currentPortionSize` because recipe isn't observable
4. âŒ UI shows cached old value (200g)

**Proof:** If you CLOSE the modal and REOPEN it, it WILL show 150g (because it reads fresh from Core Data).

### Expected Behavior (AFTER FIX)

```
INITIAL STATE:   Portion card shows "200g"
                 â†“
USER ACTION:     1. Tap portion card to expand
                 2. Move slider to 150g
                 3. Tap "Porsiyonu Kaydet"
                 â†“
SAVE LOGIC:      recipe.portionSize = 150g âœ…
                 portionMultiplier = 1.0 âœ… RESET
                 try viewContext.save() âœ…
                 â†“
UI UPDATES:      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Success banner shows âœ…                 â”‚
                 â”‚ Card collapses âœ…                       â”‚
                 â”‚ Portion card shows "150g" âœ…            â”‚
                 â”‚ Stepper shows "1.0x" âœ…                 â”‚
                 â”‚ Main card shows "1 porsiyon: 150g" âœ…   â”‚
                 â”‚ All values correct! âœ…                  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ BUG #3: SLIDER DOESN'T UPDATE NUTRITION VALUES

### UI Element: Portion Size Slider

**Location:** Inside expanded portion card
**File:** `NutritionalValuesView.swift` lines 508-520

```swift
Slider(
    value: $adjustingPortionWeight,
    in: minPortionSize...recipe.totalRecipeWeight,
    step: sliderStep
)
.onChange(of: adjustingPortionWeight) { _, newValue in
    // Update portion multiplier to reflect slider changes
    guard recipe.portionSize > 0 else { return }
    let ratio = newValue / recipe.portionSize  // 150 / 200 = 0.75
    portionMultiplier = ratio
}
```

### Current Behavior (BROKEN)

```
INITIAL STATE:   Slider at 200g
                 Main card shows 500 kcal, 50g carbs
                 â†“
USER ACTION:     Move slider to 150g
                 â†“
STATE UPDATES:   adjustingPortionWeight: 200 â†’ 150 âœ…
                 â†“
SLIDER CHANGE:   ratio = 150 / 200 = 0.75 âœ…
                 portionMultiplier = 0.75 âœ…
                 â†“
UI UPDATES:      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Gram display: "150g" âœ…                 â”‚
                 â”‚ Header: "1 porsiyon: 150g" âœ…           â”‚
                 â”‚ Stepper: "0.75x" âœ…                     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Calories: 500 kcal âŒ FROZEN            â”‚
                 â”‚ Carbs: 50g âŒ FROZEN                    â”‚
                 â”‚ (Should be 375 kcal, 37.5g)             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**EXPECTED:** As slider moves, nutrition values should update in real-time

### Why It's Broken

**Same root cause as Bug #1:** Computed properties not tracked by SwiftUI.

```
Slider changes â†’ portionMultiplier updates â†’ But nutrition rows don't re-render
                                              because they use computed properties
```

### Expected Behavior (AFTER FIX)

```
INITIAL STATE:   Slider at 200g
                 Main card shows 500 kcal, 50g carbs
                 â†“
USER ACTION:     Move slider to 150g (SMOOTH CONTINUOUS DRAG)
                 â†“
STATE UPDATES:   adjustingPortionWeight: 200 â†’ 190 â†’ 180 â†’ 170 â†’ 160 â†’ 150
                 â†“
REAL-TIME:       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ As slider moves:                        â”‚
                 â”‚ - Gram display updates continuously âœ…  â”‚
                 â”‚ - Header updates continuously âœ…        â”‚
                 â”‚ - Calories: 500 â†’ 475 â†’ 450 â†’ ... âœ…   â”‚
                 â”‚ - Carbs: 50 â†’ 47.5 â†’ 45 â†’ ... âœ…       â”‚
                 â”‚ - ALL nutrition values update LIVE! âœ…  â”‚
                 â”‚                                         â”‚
                 â”‚ User gets INSTANT FEEDBACK âœ…           â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ELEMENT-BY-ELEMENT MAPPING

### 1. Stepper (- 1.0x +)

**File:** Lines 449-475
**Property:** `portionMultiplier` (@Binding)
**Current:** âŒ Only stepper text updates
**After Fix:** âœ… ALL nutrition values update

| Action | Before | After |
|--------|--------|-------|
| Tap [-] | Stepper: 1.0x â†’ 0.5x âœ…<br>Header: Updates âœ…<br>Calories: NO âŒ | Stepper: 1.0x â†’ 0.5x âœ…<br>Header: Updates âœ…<br>Calories: 500 â†’ 250 âœ… |
| Tap [+] | Stepper: 1.0x â†’ 1.5x âœ…<br>Header: Updates âœ…<br>Carbs: NO âŒ | Stepper: 1.0x â†’ 1.5x âœ…<br>Header: Updates âœ…<br>Carbs: 50 â†’ 75 âœ… |

---

### 2. Collapsed Portion Display (200g)

**File:** Lines 437-447
**Property:** `currentPortionSize` (computed from `recipe.portionSize`)
**Current:** âŒ Shows old value after save
**After Fix:** âœ… Shows new value immediately

| Action | Before | After |
|--------|--------|-------|
| Save 150g | Save succeeds âœ…<br>Card shows "200g" âŒ | Save succeeds âœ…<br>Card shows "150g" âœ… |
| Reopen modal | Now shows "150g" âœ…<br>(Had to close/reopen) | Shows "150g" immediately âœ…<br>(No need to close/reopen) |

---

### 3. Slider

**File:** Lines 508-520
**Property:** `adjustingPortionWeight` (@State)
**Current:** âŒ Nutrition values frozen
**After Fix:** âœ… Real-time updates

| Action | Before | After |
|--------|--------|-------|
| Slide to 150g | Gram display: "150g" âœ…<br>Calories: NO âŒ | Gram display: "150g" âœ…<br>Calories: LIVE âœ… |
| Slide to 300g | Stepper: "1.5x" âœ…<br>Protein: NO âŒ | Stepper: "1.5x" âœ…<br>Protein: LIVE âœ… |

---

### 4. Header Text (1 porsiyon: 272g)

**File:** Lines 334-347 (`infoText` computed property)
**Property:** Reads `totalRecipeWeight * portionMultiplier`
**Current:** âœ… WORKS (updates correctly)
**After Fix:** âœ… STILL WORKS

**Why it works:** This text IS re-evaluated because it's directly in the view body.

---

### 5. Nutrition Rows (Kalori, Karbonhidrat, etc.)

**File:** Lines 94-168
**Property:** Uses `displayedCalories`, `displayedCarbohydrates`, etc.
**Current:** âŒ BROKEN (frozen values)
**After Fix:** âœ… WORKS (live updates)

| Row | Before | After |
|-----|--------|-------|
| Kalori | Shows 500 kcal (frozen) âŒ | Updates to 750 kcal at 1.5x âœ… |
| Karbonhidrat | Shows 50g (frozen) âŒ | Updates to 75g at 1.5x âœ… |
| Protein | Shows 30g (frozen) âŒ | Updates to 45g at 1.5x âœ… |
| YaÄŸ | Shows 15g (frozen) âŒ | Updates to 22.5g at 1.5x âœ… |
| Glisemik YÃ¼k | Shows 20 (frozen) âŒ | Updates to 30 at 1.5x âœ… |

---

### 6. Save Button ("Porsiyonu Kaydet")

**File:** Lines 539-548
**Action:** Calls `savePortionSize()`
**Current:** âœ… Saves to Core Data, âŒ UI doesn't update
**After Fix:** âœ… Saves AND updates UI

**Before:**
```
Click Save â†’ recipe.portionSize = 150g
          â†’ Core Data saves
          â†’ UI shows OLD value (200g) âŒ
```

**After:**
```
Click Save â†’ recipe.portionSize = 150g
          â†’ portionMultiplier = 1.0 (RESET)
          â†’ Core Data saves
          â†’ UI shows NEW value (150g) âœ…
```

---

### 7. Success Banner

**File:** Lines 257-275
**Property:** `showSuccessBanner` (@State)
**Current:** âœ… WORKS
**After Fix:** âœ… STILL WORKS

No changes needed for success banner.

---

## ğŸ“Š SUMMARY TABLE

| UI Element | Current Status | After Fix | Affected By |
|------------|---------------|-----------|-------------|
| Stepper (- 1.0x +) | âš ï¸ Partial (only stepper updates) | âœ… Full (all values update) | Bug #1 |
| Collapsed Portion Display | âŒ Broken (shows old value) | âœ… Fixed (shows new value) | Bug #2 |
| Slider | âš ï¸ Partial (only gram display) | âœ… Full (real-time updates) | Bug #3 |
| Header Text | âœ… Working | âœ… Working | None |
| Nutrition Rows | âŒ Broken (frozen) | âœ… Fixed (reactive) | Bug #1, #3 |
| Save Button | âš ï¸ Partial (saves but no UI update) | âœ… Full (saves + updates) | Bug #2 |
| Success Banner | âœ… Working | âœ… Working | None |

---

## ğŸ”§ HOW THE FIX WORKS

### Fix 1: Inline Calculations (Fixes Bugs #1, #3)

**Before:**
```swift
// Computed property (not tracked)
private var displayedCalories: String {
    let value = (Double(caloriesPerServing) ?? 0) * portionMultiplier
    return String(format: "%.0f", value)
}

// View uses it indirectly
nutritionRow(label: "Kalori", value: displayedCalories, unit: "kcal")
```

**After:**
```swift
// Inline calculation (directly tracked)
let caloriesValue = selectedTab == 0
    ? String(format: "%.0f", (Double(caloriesPerServing) ?? 0) * portionMultiplier)
    : calories

// View uses it directly
nutritionRow(label: "Kalori", value: caloriesValue, unit: "kcal")
```

**Result:** SwiftUI sees direct reference to `portionMultiplier` â†’ Tracks dependency â†’ Re-renders when it changes

---

### Fix 2: Observable Recipe (Fixes Bug #2)

**Before:**
```swift
let recipe: Recipe?  // Not observable
```

**After:**
```swift
@ObservedObject var recipe: Recipe  // Observable
```

**Result:** SwiftUI tracks changes to `recipe.portionSize` â†’ Re-renders when it changes

---

### Fix 3: Reset Multiplier (Improves UX)

**Before:**
```swift
recipe.updatePortionSize(adjustingPortionWeight)
try viewContext.save()
// portionMultiplier stays at old value (e.g., 0.75)
```

**After:**
```swift
recipe.updatePortionSize(adjustingPortionWeight)
portionMultiplier = 1.0  // RESET
try viewContext.save()
```

**Result:** After defining new portion, multiplier resets to 1.0x (predictable UX)

---

**END OF UI ELEMENT BREAKDOWN**
