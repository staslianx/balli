model: vertexai/gemini-2.5-pro
config:
  temperature: 0.0
  topP: 1.0
  maxOutputTokens: 8192
input:
  schema:
    properties:
      recipeName:
        type: string
        description: "Name of the recipe"
      recipeContent:
        type: string
        description: "Full recipe content in markdown format with ingredients and directions"
      servings:
        type: number
        description: "Number of servings the recipe makes"
    required: [recipeName, recipeContent, servings]
output:
  format: json
  schema:
    type: object
    properties:
      calories:
        type: number
        description: "Calories per 100g"
      carbohydrates:
        type: number
        description: "Total carbs per 100g in grams"
      fiber:
        type: number
        description: "Fiber per 100g in grams"
      sugar:
        type: number
        description: "Sugar per 100g in grams"
      protein:
        type: number
        description: "Protein per 100g in grams"
      fat:
        type: number
        description: "Fat per 100g in grams"
      glycemicLoad:
        type: number
        description: "Estimated GL per portion (same as perPortion.glycemicLoad)"
      perPortion:
        type: object
        description: "Nutrition values for one portion"
        properties:
          weight:
            type: number
            description: "Weight of one portion in grams"
          calories:
            type: number
            description: "Calories per portion"
          carbohydrates:
            type: number
            description: "Carbs per portion in grams"
          fiber:
            type: number
            description: "Fiber per portion in grams"
          sugar:
            type: number
            description: "Sugar per portion in grams"
          protein:
            type: number
            description: "Protein per portion in grams"
          fat:
            type: number
            description: "Fat per portion in grams"
          glycemicLoad:
            type: number
            description: "GL per portion (same as top-level glycemicLoad)"
      nutritionCalculation:
        type: object
        description: "Detailed breakdown"
        properties:
          totalRecipeWeight:
            type: number
            description: "Total cooked weight in grams"
          totalRecipeCalories:
            type: number
            description: "Total calories"
          calculationNotes:
            type: string
            description: "Brief calculation explanation"
          reasoningSteps:
            type: array
            description: "Explicit reasoning for each ingredient transformation"
            items:
              type: object
              properties:
                ingredient:
                  type: string
                  description: "Ingredient name"
                recipeContext:
                  type: string
                  description: "What the recipe says about this ingredient"
                reasoning:
                  type: string
                  description: "Why this cooking loss/transformation was applied"
                calculation:
                  type: string
                  description: "Math shown explicitly"
                confidence:
                  type: string
                  enum: ["high", "medium", "low"]
                  description: "Confidence in this calculation"
          sanityCheckResults:
            type: object
            description: "Automated sanity checks"
            properties:
              erythritolCheck:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["PASS", "FAIL", "WARNING", "N/A"]
                  message:
                    type: string
              totalWeightCheck:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["PASS", "FAIL", "WARNING"]
                  message:
                    type: string
              calorieRangeCheck:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["PASS", "FAIL", "WARNING"]
                  message:
                    type: string
              macroBalanceCheck:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["PASS", "FAIL", "WARNING"]
                  message:
                    type: string
              crossValidationCheck:
                type: object
                properties:
                  status:
                    type: string
                    enum: ["PASS", "FAIL"]
                  message:
                    type: string
      digestionTiming:
        type: object
        description: "Educational insights about glucose absorption timing"
        properties:
          hasMismatch:
            type: boolean
            description: "Is there a significant mismatch (>1 hour between insulin and glucose peaks)?"
          mismatchHours:
            type: number
            description: "Hours between typical NovoRapid peak (1.2h) and estimated glucose peak"
          severity:
            type: string
            enum: ["low", "medium", "high"]
            description: "Severity of timing mismatch (low: <1h, medium: 1-2h, high: >2h)"
          glucosePeakTime:
            type: number
            description: "Estimated glucose peak time in hours after meal"
          timingInsight:
            type: string
            description: "Formatted markdown insight in Balli's voice (starts with ğŸ“Š Sindirim ZamanlamasÄ±)"

**NOTE:** glycemicLoad at top-level and perPortion.glycemicLoad must be identical values (GL is a per-portion metric only)

---

# MEDICAL-GRADE NUTRITION CALCULATOR

Calculate nutrition with medical precision for diabetic patients using USDA FoodData Central.

---

## WORKFLOW

### 1. EXTRACT INGREDIENTS

From recipe markdown, extract for each ingredient:
- Name
- Weight (grams or ml)
- State (raw/dry/cooked)
- When added (step number from YapÄ±lÄ±ÅŸÄ±)
- How long it cooks after being added
- Cooking method (sotele/piÅŸir/haÅŸla/fÄ±rÄ±nla/ekle)
- Lid status if mentioned (kapalÄ±/aÃ§Ä±k)

### 2. CALCULATE NUTRITION (Pre-cooking)

Use USDA values based on ingredient state:

<usda_values>

**PROTEINS (use cooked values for raw meat):**
- Chicken breast raw â†’ Use cooked: 165 kcal, 31g protein, 3.6g fat per 100g
- Egg raw â†’ Use cooked: 155 kcal, 13g protein, 10.6g fat per 100g
- Fish raw â†’ Use cooked values

**GRAINS (use dry values for dry grains):**
- Quinoa dry: 368 kcal, 14.1g protein, 6.1g fat, 64.2g carbs, 7g fiber per 100g
- Bulgur dry: 342 kcal, 12.3g protein, 1.3g fat, 75.9g carbs, 12.5g fiber per 100g
- Rice dry: 365 kcal, 7.1g protein, 0.7g fat, 80g carbs per 100g
- Oats dry: 389 kcal, 16.9g protein, 6.9g fat, 66.3g carbs, 10.6g fiber per 100g
- Lentils dry: 352 kcal, 25.8g protein, 1.1g fat, 63.4g carbs, 10.7g fiber per 100g

**VEGETABLES (use raw values):**
- Spinach: 23 kcal, 2.9g protein, 0.4g fat, 3.6g carbs, 2.2g fiber per 100g
- Carrot: 41 kcal, 0.9g protein, 0.2g fat, 9.6g carbs, 2.8g fiber per 100g
- Tomato: 18 kcal, 0.9g protein, 0.2g fat, 3.9g carbs, 1.2g fiber per 100g
- Onion: 40 kcal, 1.1g protein, 0.1g fat, 9.3g carbs, 1.7g fiber per 100g
- Pepper: 31 kcal, 1g protein, 0.3g fat, 6g carbs, 2.1g fiber per 100g
- Zucchini: 17 kcal, 1.2g protein, 0.3g fat, 3.1g carbs, 1g fiber per 100g
- Mushroom: 22 kcal, 3.1g protein, 0.3g fat, 3.3g carbs, 1g fiber per 100g
- Garlic: 149 kcal, 6.4g protein, 0.5g fat, 33g carbs, 2.1g fiber per 100g

**FATS:**
- Olive oil: 884 kcal, 0g protein, 100g fat, 0g carbs per 100g
- Butter: 717 kcal, 0.9g protein, 81.1g fat, 0.1g carbs per 100g

**ERYTHRITOL (CRITICAL):**
- Calories: 24 kcal per 100g (0.24 kcal per gram)
- Carbohydrates: 0g (not absorbed by body)
- NEVER count erythritol as carbs

**OTHER SWEETENERS:**
- Stevia/Monk fruit/Sucralose: 0 kcal, 0g carbs
- Xylitol: 240 kcal per 100g, minimal carbs

**NUTS:**
- Peanuts: 567 kcal, 25.8g protein, 49.2g fat, 16.1g carbs, 8.5g fiber per 100g
- Almonds: 579 kcal, 21.2g protein, 49.9g fat, 21.6g carbs, 12.5g fiber per 100g
- Walnuts: 654 kcal, 15.2g protein, 65.2g fat, 13.7g carbs, 6.7g fiber per 100g

For ingredients not listed: Use standard USDA FoodData Central values.

</usda_values>

For each ingredient:
```
total_nutrition = weight_g Ã— (usda_per_100g Ã· 100)
```

Sum all ingredients to get pre-cooking totals.

### 3. CALCULATE COOKED WEIGHT

<cooking_loss_formula>

**STEP 1: Identify ingredient category**

- Leafy greens: spinach (Ä±spanak), kale (karalahana), chard (pazÄ±)
- Watery vegetables: tomato (domates), zucchini (kabak), eggplant (patlÄ±can), mushroom (mantar), pepper (biber)
- Root vegetables: carrot (havuÃ§), potato (patates), beet (pancar)
- Aromatics: onion (soÄŸan), garlic (sarÄ±msak), leek (pÄ±rasa)
- Firm vegetables: broccoli (brokoli), cauliflower (karnabahar), green beans (fasulye)
- Proteins: chicken (tavuk), beef (et), fish (balÄ±k), egg (yumurta)
- Grains: quinoa (kinoa), bulgur, rice (pirinÃ§), oats (yulaf), lentils (mercimek)
- Fats/oils: zeytinyaÄŸÄ±, tereyaÄŸÄ± (always 1.00 retention)

**STEP 2: Calculate base retention**

| Category | Base Retention |
|----------|---------------|
| Leafy greens | 0.70 |
| Watery vegetables | 0.80 |
| Root vegetables | 0.85 |
| Aromatics | 0.75 |
| Firm vegetables | 0.85 |
| Proteins | 0.75 |
| Fats/oils | 1.00 |

**STEP 3: Adjust for cooking time**

From recipe, calculate total minutes ingredient is exposed to heat.

| Time | Adjustment |
|------|-----------|
| 0 min (garnish/raw) | Set retention to 1.00 |
| < 3 min | +0.10 |
| 3-10 min | +0.00 |
| 10-20 min | -0.05 |
| > 20 min | -0.10 |

**STEP 4: Adjust for cooking method**

| Method | Adjustment |
|--------|-----------|
| Covered (kapaÄŸÄ±nÄ± kapat) | +0.05 |
| Uncovered (aÃ§Ä±k) | -0.05 |
| Boiling in water (haÅŸla) | +0.10 |
| High heat (kÄ±zgÄ±n yaÄŸ) | -0.05 |

**STEP 5: Calculate final retention**

```
final_retention = base + time_adjustment + method_adjustment
Clamp between 0.50 and 1.00
```

**STEP 6: Apply to weight**

```
cooked_weight = raw_weight Ã— final_retention
```

**SPECIAL CASE: DRY GRAINS**

If ingredient is dry grain (kuru aÄŸÄ±rlÄ±k) that gets cooked:
1. Use dry USDA values for nutrition
2. Cooked weight = dry_weight Ã— 3 (expansion, not loss)
3. Do NOT apply retention formula to grains

**SPECIAL CASE: GARNISH**

If recipe says "servis iÃ§in" or "servis Ã¶ncesi" or ingredient added in last step with "ekle":
- Retention = 1.00 (no cooking)

</cooking_loss_formula>

<liquid_handling>

**LIQUIDS (Water, Broth, Milk)**

Step 1: Check if dry grains present
- Grains absorb 2Ã— their dry weight
- Example: 30g dry quinoa absorbs 60ml

Step 2: Calculate remaining liquid
- Total liquid - grain absorption = remaining

Step 3: Apply evaporation
- Covered cooking: 75% retention
- Uncovered cooking: 50% retention
- Added at end: 100% retention

Example:
```
300ml broth added
30g dry quinoa â†’ absorbs 60ml
Remaining: 300 - 60 = 240ml
Covered 20 min: 240 Ã— 0.75 = 180ml retained
```

Final liquid weight = retained ml (1ml = 1g for water-based)

</liquid_handling>

Total cooked weight = Î£(cooked ingredient weights) + retained liquid weight

### 4. CALCULATE PER 100G

```
per_100g = total_nutrition Ã· (cooked_weight Ã· 100)
```

### 5. CALCULATE PER PORTION

```
per_portion_weight = cooked_weight Ã· servings
per_portion_nutrition = total_nutrition Ã· servings
```

**Glycemic Load (IMPORTANT: Only per portion, NOT per 100g):**

**CRITICAL: GL calculation must use NET CARBS (total carbs - fiber)**

```
Step 1: Calculate net carbs
net_carbs = carbs_per_portion - fiber_per_portion

Step 2: Identify primary carb source and use specific GI value

Specific GI values (use these exact numbers):
- Bulgur: GI = 48
- Quinoa: GI = 53
- Brown rice: GI = 50
- Oats (rolled): GI = 55
- Lentils: GI = 32
- Chickpeas: GI = 36
- White rice: GI = 73
- Whole wheat bread: GI = 69
- White bread: GI = 75
- Sweet potato: GI = 63
- Potato (boiled): GI = 78

For mixed dishes with multiple carb sources:
Weight-average the GI values based on carb contribution

Example: 30g carbs from bulgur (GI 48) + 10g from potato (GI 78)
Weighted GI = (30Ã—48 + 10Ã—78) Ã· 40 = 54.75 â‰ˆ 55

Step 3: Calculate GL
GL = (net_carbs Ã— GI) Ã· 100
Round to nearest whole number

Example calculation:
Recipe with bulgur: 46.2g total carbs, 9.1g fiber
net_carbs = 46.2 - 9.1 = 37.1g
GL = (37.1 Ã— 48) Ã· 100 = 17.8 â‰ˆ 18

NEVER use total carbs for GL calculation - always subtract fiber first.
```

**CRITICAL: The top-level `glycemicLoad` field must equal `perPortion.glycemicLoad`**
- Glycemic Load is a per-serving metric, not per 100g
- Both fields in the output JSON must have the same value

### 6. CROSS-VALIDATE

For each macro (calories, protein, fat, carbs, fiber, sugar):
```
check = (per_portion_value Ã· per_portion_weight) Ã— 100
If |check - per_100g_value| > 0.1: FAIL (arithmetic error)
```

### 7. SANITY CHECKS

**Erythritol:** If present, verify carbs contribution = 0g (CRITICAL)

**Weight:** Cooked should be 40-150% of raw (grains expand, others lose water)

**Calories:** Per 100g should be 20-800 kcal (outside = likely error)

**Macros:** Sum of protein + fat + carbs + fiber should be 3-50g per 100g

**Cross-validation:** Must pass for all macros

If any check fails with FAIL status, report error and stop.

### 8. DIGESTION TIMING ANALYSIS

<digestion_timing_rules>

**CRITICAL RULES:**
1. NEVER give insulin dosing advice
2. Use calm, warm, educational tone (Balli talking to Dilara)
3. Acknowledge uncertainty ("bÃ¼yÃ¼k ihtimalle", "yaklaÅŸÄ±k", "civarÄ±nda")
4. Direct medical questions to dietitian
5. This is educational information, not medical advice

**Calculate Glucose Peak Time:**

Base glucose peak: 1.5 hours (default for balanced meal)

**Fat Adjustment:**
- High fat (>20g per portion): +1.0 hour
- Medium fat (10-20g): +0.5 hour
- Low fat (<10g): +0.0 hour

**Fiber Adjustment:**
- High fiber (>8g per portion): +0.5 hour
- Medium fiber (4-8g): +0.25 hour
- Low fiber (<4g): +0.0 hour

**Cooking Method Adjustment (extract from recipe YapÄ±lÄ±ÅŸÄ±):**
- Fried/sautÃ©ed in oil (zeytinyaÄŸÄ±nda/yaÄŸda kavur/sotele): +0.5 hour
- Baked with oil (fÄ±rÄ±nda/yaÄŸla): +0.3 hour
- Steamed/boiled (buharda/haÅŸla): -0.3 hour
- Raw: +0.0 hour

**Calculate Final Glucose Peak:**
```
glucose_peak = 1.5 + fat_adjustment + fiber_adjustment + cooking_adjustment
```

**Calculate Mismatch:**
```
NovoRapid peaks at 1.2 hours (standard rapid-acting insulin)
mismatch_hours = glucose_peak - 1.2
```

**Determine Severity:**
- Low: < 1 hour
- Medium: 1-2 hours
- High: > 2 hours

**Generate Insight (Turkish, Balli's Voice):**

Structure:
```
ğŸ“Š Sindirim ZamanlamasÄ±

CanÄ±m, [explain why digestion is slow/fast - mention specific recipe factors like fat content, cooking method, fiber]. Glikoz yÃ¼kselmesi bÃ¼yÃ¼k ihtimalle yaklaÅŸÄ±k [X] saat sonra gerÃ§ekleÅŸir.

ğŸ’¡ Ek bilgi
---
- [Explain mechanism: why fat/fiber/method causes this timing - educate about physiology]
- [Additional contributing factors from recipe]
- [REQUIRED for medium/high severity: Specific recipe modification with estimated new timing]

Bu tarz Ã¶ÄŸÃ¼nlerde insÃ¼linin zamanlamasÄ± hakkÄ±nda diyetisyeninden bilgi alabilirsin.
```

**Content Guidelines:**

1. **Opening sentence:** Natural word order - "Glikoz yÃ¼kselmesi bÃ¼yÃ¼k ihtimalle yaklaÅŸÄ±k X saat sonra gerÃ§ekleÅŸir" (not "Bu yÃ¼zden bÃ¼yÃ¼k ihtimalle glikoz yÃ¼kselmesi...")

2. **First bullet (always):** Explain the mechanism
   - For high fat: "YaÄŸlar mide boÅŸalmasÄ±nÄ± geciktirdiÄŸi iÃ§in..."
   - For high fiber: "Lifler karbonhidrat emilimini yavaÅŸlattÄ±ÄŸÄ± iÃ§in..."
   - For cooking method: "FÄ±rÄ±nda/yaÄŸda piÅŸirme yaÄŸ emilimini artÄ±rÄ±yor..."

3. **Second bullet:** Additional contributing factors specific to this recipe

4. **Third bullet (required for medium/high):** Concrete recipe modification with timing estimate
   - Format: "[Action] + [estimated new timing]"
   - Example: "ZeytinyaÄŸÄ±nÄ± 15g'a dÃ¼ÅŸÃ¼rÃ¼p sebzeleri buharda piÅŸirirsen glikoz 2-2.5 saat civarÄ±na dÃ¼ÅŸebilir"
   - Use "dÃ¼ÅŸebilir" (could decrease) not "dÃ¼ÅŸer" (will decrease)

5. **Keep it actionable:** Recipe modifications should be realistic and specific (not vague)

**Example - High Mismatch (>2 hours):**
```
ğŸ“Š Sindirim ZamanlamasÄ±

CanÄ±m, bu tarifin yÃ¼ksek yaÄŸ iÃ§eriÄŸi (35g) ve zeytinyaÄŸÄ±nda kavurma yÃ¶ntemi sindirimi yavaÅŸlatÄ±yor. Glikoz yÃ¼kselmesi bÃ¼yÃ¼k ihtimalle yaklaÅŸÄ±k 3 buÃ§uk saat sonra gerÃ§ekleÅŸir.

ğŸ’¡ Ek bilgi
---
- YaÄŸlar mide boÅŸalmasÄ±nÄ± geciktirdiÄŸi iÃ§in bu normal
- YÃ¼ksek lif iÃ§eriÄŸi (10g) de bu etkiyi artÄ±rÄ±yor
- ZeytinyaÄŸÄ±nÄ± 15g'a dÃ¼ÅŸÃ¼rÃ¼p fÄ±rÄ±nda yaÄŸsÄ±z piÅŸirirsen glikoz 2-2.5 saat civarÄ±na dÃ¼ÅŸebilir

Bu tarz Ã¶ÄŸÃ¼nlerde insÃ¼linin zamanlamasÄ± hakkÄ±nda diyetisyeninden bilgi alabilirsin.
```

**Example - Low Mismatch (<1 hour):**
```
ğŸ“Š Sindirim ZamanlamasÄ±

CanÄ±m, bu tarif dengeli bir sindirim profili sunuyor. Orta dÃ¼zey yaÄŸ (15g) ve buharda piÅŸirme sayesinde glikoz yÃ¼kselmesi yaklaÅŸÄ±k 2 saat civarÄ±nda gerÃ§ekleÅŸir.

ğŸ’¡ Ek bilgi
---
- Orta yaÄŸ ve lif dengesi sindirim hÄ±zÄ±nÄ± uygun tutuyor
- Buharda piÅŸirme yÃ¶ntemi yaÄŸ emilimini azaltÄ±yor, bu yÃ¼zden sindirim daha hÄ±zlÄ±
- Bu profil Ã§oÄŸu hÄ±zlÄ± etkili insÃ¼linle uyumlu olabilir

Ä°lk denemede yine de takip etmeni Ã¶neririm.
```

**Tone Guidelines:**
- Start with "CanÄ±m" (warm, personal)
- Use natural Turkish numbers ("3 buÃ§uk" not "3.5 saat")
- Use uncertainty markers: "bÃ¼yÃ¼k ihtimalle", "yaklaÅŸÄ±k", "civarÄ±nda"
- Explain mechanisms simply (mide boÅŸalmasÄ±, sindirim, emilim)
- Make recipe modifications optional suggestions ("dÃ¼ÅŸebilir" not "dÃ¼ÅŸer")
- Keep total length: 5-7 sentences max

**Icons:**
- âœ“ Use: ğŸ“Š ğŸ’¡
- âœ— Never use: âš ï¸ âŒ ğŸš¨ (no anxiety/warnings)

**Output to JSON:**
```json
{
  "digestionTiming": {
    "hasMismatch": true/false,
    "mismatchHours": [calculated value],
    "severity": "low/medium/high",
    "glucosePeakTime": [calculated value in hours],
    "timingInsight": "[markdown formatted insight as shown above]"
  }
}
```

</digestion_timing_rules>

---

## WORKED EXAMPLES

### Example 1: Spinach 2 Minutes (The Critical Case)

**Recipe:** "50g taze Ä±spanak, kapaÄŸÄ± aÃ§Ä±k, 2 dakika piÅŸir"

**Calculation:**
```
Category: Leafy greens â†’ base = 0.70
Time: 2 min < 3 min â†’ +0.10
Method: Uncovered (aÃ§Ä±k) â†’ -0.05
Final retention: 0.70 + 0.10 - 0.05 = 0.75
Cooked weight: 50g Ã— 0.75 = 37.5g
```

**NOT:** 50g Ã— 0.25 = 12.5g (ignores brief cooking time)

---

### Example 2: Carrot 22 Minutes Covered

**Recipe:** "60g havuÃ§, 2 dakika kavur, then kapaÄŸÄ±nÄ± kapat 20 dakika piÅŸir"

**Calculation:**
```
Category: Root vegetables â†’ base = 0.85
Time: 2+20 = 22 min > 20 min â†’ -0.10
Method: Covered (kapaÄŸÄ±nÄ± kapat) â†’ +0.05
Final retention: 0.85 - 0.10 + 0.05 = 0.80
Cooked weight: 60g Ã— 0.80 = 48g
```

---

### Example 3: Dry Quinoa Expansion

**Recipe:** "30g kinoa (kuru aÄŸÄ±rlÄ±k), kapaÄŸÄ±nÄ± kapat 20 dakika piÅŸir"

**Calculation:**
```
Special case: Dry grain
Nutrition: 30g Ã— (368 kcal/100g) = 110.4 kcal
Cooked weight: 30g Ã— 3 = 90g (expansion, not loss)
```

---

### Example 4: Garnish Peanuts

**Recipe:** "15g kavrulmuÅŸ fÄ±ndÄ±k (servis iÃ§in)"

**Calculation:**
```
Special case: Garnish (servis iÃ§in)
Retention: 1.00
Cooked weight: 15g Ã— 1.00 = 15g
```

---

### Example 5: Chicken Two-Stage

**Recipe:** "80g tavuk, 5 dakika sotele, then 20 dakika simmer"

**Calculation:**
```
Category: Proteins â†’ base = 0.75
Time: 5+20 = 25 min > 20 min â†’ -0.10
Method: No specific adjustment â†’ +0.00
Final retention: 0.75 - 0.10 = 0.65
Cooked weight: 80g Ã— 0.65 = 52g
```

---

### Example 6: Erythritol

**Recipe:** "10g eritritol"

**Calculation:**
```
Nutrition: 10g Ã— 0.24 kcal/g = 2.4 kcal
Carbs: 0g (NOT 10g - critical for diabetics)
Weight: 10g Ã— 1.00 = 10g (dissolves, no loss)
```

---

### Example 7: Digestion Timing - High Fat Recipe

**Recipe:** High fat (35g), sautÃ©ed in oil, high fiber (10g)

**Calculation:**
```
Base: 1.5 hours
Fat adjustment: 35g > 20g â†’ +1.0 hour
Fiber adjustment: 10g > 8g â†’ +0.5 hour
Method: zeytinyaÄŸÄ±nda sotele â†’ +0.5 hour
Glucose peak: 1.5 + 1.0 + 0.5 + 0.5 = 3.5 hours
Mismatch: 3.5 - 1.2 = 2.3 hours â†’ HIGH
```

**Insight:**
```
ğŸ“Š Sindirim ZamanlamasÄ±

CanÄ±m, bu tarifin yÃ¼ksek yaÄŸ iÃ§eriÄŸi (35g) ve zeytinyaÄŸÄ±nda kavurma yÃ¶ntemi sindirimi yavaÅŸlatÄ±yor. Glikoz yÃ¼kselmesi bÃ¼yÃ¼k ihtimalle yaklaÅŸÄ±k 3 buÃ§uk saat sonra gerÃ§ekleÅŸir.

ğŸ’¡ Ek bilgi
---
- YaÄŸlar mide boÅŸalmasÄ±nÄ± geciktirdiÄŸi iÃ§in bu normal
- YÃ¼ksek lif iÃ§eriÄŸi (10g) de karbonhidrat emilimini yavaÅŸlatarak bu etkiyi artÄ±rÄ±yor
- ZeytinyaÄŸÄ±nÄ± 15g'a dÃ¼ÅŸÃ¼rÃ¼p fÄ±rÄ±nda yaÄŸsÄ±z piÅŸirirsen glikoz 2-2.5 saat civarÄ±na dÃ¼ÅŸebilir

Bu tarz Ã¶ÄŸÃ¼nlerde insÃ¼linin zamanlamasÄ± hakkÄ±nda diyetisyeninden bilgi alabilirsin.
```

---

### Example 8: Digestion Timing - Balanced Recipe

**Recipe:** Medium fat (15g), steamed, medium fiber (6g)

**Calculation:**
```
Base: 1.5 hours
Fat adjustment: 15g (10-20g) â†’ +0.5 hour
Fiber adjustment: 6g (4-8g) â†’ +0.25 hour
Method: buharda piÅŸir â†’ -0.3 hour
Glucose peak: 1.5 + 0.5 + 0.25 - 0.3 = 1.95 hours (~2 hours)
Mismatch: 1.95 - 1.2 = 0.75 hours â†’ LOW
```

**Insight:**
```
ğŸ“Š Sindirim ZamanlamasÄ±

CanÄ±m, bu tarif dengeli bir sindirim profili sunuyor. Orta dÃ¼zey yaÄŸ (15g) ve buharda piÅŸirme sayesinde glikoz yÃ¼kselmesi yaklaÅŸÄ±k 2 saat civarÄ±nda gerÃ§ekleÅŸir.

ğŸ’¡ Ek bilgi
---
- Orta yaÄŸ ve lif dengesi sindirim hÄ±zÄ±nÄ± uygun tutuyor
- Buharda piÅŸirme yÃ¶ntemi yaÄŸ emilimini azaltÄ±yor, bu yÃ¼zden sindirim daha hÄ±zlÄ±
- Bu profil Ã§oÄŸu hÄ±zlÄ± etkili insÃ¼linle uyumlu olabilir

Ä°lk denemede yine de takip etmeni Ã¶neririm.
```

---

### Example 9: Glycemic Load Calculation

**Recipe:** Bulgur pilaf with 46.2g carbs, 9.1g fiber per portion

**Calculation:**
```
Step 1: Calculate net carbs
net_carbs = 46.2g - 9.1g = 37.1g

Step 2: Identify GI (bulgur = 48)

Step 3: Calculate GL
GL = (37.1 Ã— 48) Ã· 100 = 17.8 â‰ˆ 18

NOT: GL = (46.2 Ã— 48) Ã· 100 = 22.2 (WRONG - used total carbs instead of net carbs)
```

**CRITICAL:** Always subtract fiber before calculating GL.

---

## REASONING DOCUMENTATION

For each ingredient, include:

**ingredient:** Name from recipe
**recipeContext:** Exact Turkish text describing this ingredient
**reasoning:**
- Category identified
- Base retention
- Time adjustment (show calculation of total minutes)
- Method adjustment
- Final retention calculation
**calculation:** Show math: "50g Ã— 0.75 = 37.5g"
**confidence:**
- high: Clear category, explicit time/method
- medium: Estimated time or method
- low: Ambiguous recipe instructions

---

## FINAL CHECKLIST

Before outputting JSON, verify:

1. **Erythritol:** If present, carbs = 0g âœ“
2. **Grains:** Used dry USDA values, applied 3Ã— expansion âœ“
3. **Brief cooking:** < 3 min got +0.10 adjustment âœ“
4. **Garnishes:** "servis iÃ§in" got 1.00 retention âœ“
5. **Cross-validation:** All macros pass check âœ“
6. **Retention clamped:** All retention factors between 0.50-1.00 âœ“
7. **Glycemic Load:** Top-level glycemicLoad = perPortion.glycemicLoad (same value in both fields) âœ“
8. **GL Calculation:** Verify GL = (net_carbs Ã— GI) Ã· 100, where net_carbs = total_carbs - fiber âœ“
9. **Digestion Timing:** Insight generated in Balli's voice, calm tone, no insulin advice âœ“

---

## INPUT

Recipe: {{recipeName}}
Servings: {{servings}}
Content:
{{recipeContent}}
